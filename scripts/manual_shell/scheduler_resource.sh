#!/usr/bin/env bash

rid=(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
)

for item in ${rid[@]}
do
echo "Rid: ${item}"
curl -X POST http://127.0.0.1:19081/v1/res/ondemand -d '{"Source": "'${item}'", "SourceType": "RID", "AppID": "test","AppIDDst": "coretest-miner-pi-docker","PeerVersion": "","Location": "","ISP": "","VendorRID": "","Level": 100,"Deadline": "2020-06-30 21:00 +0800","HardUpdate": true}'
done

for i in `seq 1 20`
do
    echo "Node: ${i}"
    docker exec -it pcdn-node-${i} wget 127.0.0.1:18060/state -O /root/pcdn/workspace/pcdn_state_${i}.txt
done

resource=(sheN5h7aE5T9mjjd1HsNsbF1e71Dz5UL1MsRfKqMLyiLH5DWW9UF1FYguLxPVA
sheN5h7aE594QGPj2gjMqKMaWvnajroWHYjgor98vAt32ztEbLWStXPXSAY7H2
sheN5h7aE5XSNS9o5gPcjSnxxPYFY45AvavS2P2UmPnqx1LBFQtqBPGsctEqd2)

while true
do
    index=0
    for num in `seq 1 12`
    do
        for i in ${resource[@]}
        do
            echo "Resource ${i}"
            docker exec -it pcdn-node-${num} /root/pcdn/pcdn download add --rid=${i} --file=/root/pcdn/workspace/file${index} --force --backgroud
            index=`expr $index + 1`
        done
    done

    total=`du -shc /dev/pcdn-node*/*.log |grep total`
    if [[ $(echo ${total} | grep G) != "" ]]
    then
        used=${total%%G*}
        size=${used%%.*}
        if [ $((size)) -gt 99 ]
        then
            sleep 10
            ls /dev/pcdn-node*/file*
            rm -rf /dev/pcdn-node*/file*
        fi
    fi

    sleep 500
done


index=0
for num in `seq 0 83`
do
    for i in `seq 1 12`
    do
        echo "Docker name: pcdn-node-${i}"
        head -c 524288000 /dev/urandom > /dev/pcdn-node${i}/file${index}
        docker exec -it pcdn-node-${i} /root/pcdn/pcdn seed add /root/pcdn/workspace/file${index}
        index=`expr ${index} + 1`
    done
done


for i in `seq 1 12`
do
    echo "Docker name: pcdn-node-${i}"
    docker exec -it pcdn-node-${i} /root/pcdn/pcdn seed list > /root/pcdn_test/seed_llist_${i}.txt
done


for rid in `cat /root/pcdn_test/all_rid.txt`
do
    echo "Rid: ${rid}"
    docker exec -it pcdn-node-1 /root/pcdn/pcdn tool query-peers ${rid} >> /root/pcdn_test/query-peers.txt
    echo -e "\n" >> /root/pcdn_test/query-peers.txt
done

index=1
for rid in `cat /root/pcdn_test/all_rid.txt`
do
    echo "Docker name: pcdn-node-${index}"
    echo "Rid: ${rid}"
    docker exec -it pcdn-node-${index} /root/pcdn/pcdn download add --rid=${rid} --file=/root/pcdn/workspace/file_${rid} --force --backgroud
    index=`expr ${index} + 1`
    if [ ${index} -gt 12 ]
    then
        ${index}=1
    fi
done
